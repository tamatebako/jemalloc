# JemallocConfig.cmake
# --------------------
#
# jemalloc CMake package configuration file
#
# This file is installed by jemalloc and provides the jemalloc::jemalloc target.
#
# Usage:
#   find_package(jemalloc CONFIG REQUIRED)
#   target_link_libraries(your_target PRIVATE jemalloc::jemalloc)

@PACKAGE_INIT@

set(jemalloc_VERSION "@jemalloc_version@")
set(jemalloc_VERSION_MAJOR "@jemalloc_version_major@")
set(jemalloc_VERSION_MINOR "@jemalloc_version_minor@")
set(jemalloc_VERSION_PATCH "@jemalloc_version_bugfix@")

# Set paths using PACKAGE_PREFIX_DIR (provided by @PACKAGE_INIT@)
set_and_check(jemalloc_INCLUDE_DIR "@PACKAGE_CMAKE_INSTALL_INCLUDEDIR@")
set_and_check(jemalloc_LIB_DIR "@PACKAGE_CMAKE_INSTALL_LIBDIR@")

# Find dependencies
if(UNIX AND NOT APPLE)
    find_package(Threads REQUIRED)
endif()

# Find the library
find_library(jemalloc_LIBRARY
    NAMES jemalloc
    PATHS ${jemalloc_LIB_DIR}
    NO_DEFAULT_PATH
)

if(NOT jemalloc_LIBRARY)
    set(jemalloc_FOUND FALSE)
    return()
endif()

# Set output variables for compatibility
set(jemalloc_LIBRARIES ${jemalloc_LIBRARY})
set(jemalloc_INCLUDE_DIRS ${jemalloc_INCLUDE_DIR})

# Create imported target (lowercase namespace)
if(NOT TARGET jemalloc::jemalloc)
    add_library(jemalloc::jemalloc UNKNOWN IMPORTED)
    set_target_properties(jemalloc::jemalloc PROPERTIES
        IMPORTED_LOCATION "${jemalloc_LIBRARY}"
        INTERFACE_INCLUDE_DIRECTORIES "${jemalloc_INCLUDE_DIR}"
    )

    # Add platform-specific dependencies
    if(UNIX AND NOT APPLE)
        set_property(TARGET jemalloc::jemalloc APPEND PROPERTY
            INTERFACE_LINK_LIBRARIES Threads::Threads
        )
    endif()
endif()

check_required_components(jemalloc)